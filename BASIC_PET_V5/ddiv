.PAG 'DECIMAL DIVIDE'
;**DECIMAL DIVIDE FAC=ARG/FAC
;    12-20-79
;DIVISION BY ZERO ERROR IF FAC ZERO
;
DDIV	LDA FACMSD
	BNE *+5
	JMP DV0ERR
;
;DONE IF ARG IS ZERO
;
	LDA ARGMSD
	BNE DDIV5
	JMP DZEROF
;
;2'S COMPLEMENT ON DIVISOR
;AND SAVE EXPONENTS
;
DDIV5	LDA FACEXP
	EOR #$FE
	CLC
	ADC #2
	PHA
	LDA ARGEXP
	PHA
;
	LDA #0
	STA ARGEXP
	STA FACEXP
	LDX #RESMSD-RESLSD
DDIV10	STA RESLSD,X
	DEX
	BPL DDIV10
	STA RESEXP
;
;IS DIVISOR GREATER THAN DIVIDEND
;
	LDY #FACMSD-FACLSD
	LDX #0
	SEC
	SED
DDIV20	LDA ARGLSD,X
	SBC FACLSD,X
	STA ARGLSD,X
	INX
	DEY
	BPL DDIV20
	LDA ARGEXP
	SBC FACEXP
	STA ARGEXP
	CLD
	PHP             ;DECREMENT FLAG
	BCS DDIV80
;
;RESTORE ARG
;
DDIV30	LDY #FACMSD-FACLSD
	LDX #0
	CLC
	SED
DDIV40	LDA ARGLSD,X
	ADC FACLSD,X
	STA ARGLSD,X
	INX
	DEY
	BPL DDIV40
	LDA ARGEXP
	ADC FACEXP
	STA ARGEXP
	CLD
;
;IS RESMSD ZERO?
;
	LDA RESMSD
	AND #$0F
	BEQ DDIV45
	PLP
	PLA
;
;ADJUST EXPONENT
;
	BCS DDIV43
	SEC
	SBC #2
	PHA
	LSR A
	CMP #$3F
	BNE DDIV41
	PLA
	PLA
	JMP DZEROF
DDIV41	PLA
DDIV43	STA ARGEXP
	PLA
	STA FACEXP
	JMP DMULDN
;
;SHIFT ARG MANTISSA LEFT ONE DIGIT
;
DDIV45	LDY #3
DDIV50	LDX #0
	CLC
	PHP
DDIV52	PLP
	ROL ARGLSD,X
	PHP
	INX
	CPX #1+ARGMSD-ARGLSD
	BCC DDIV52
	PLP
	ROL ARGEXP
;
;SHIFT RES MANTISSA LEFT ONE DIGIT
;
	LDX #0
	CLC
	PHP
DDIV62	PLP
	ROL RESLSD,X
	PHP
	INX
	CPX #1+RESMSD-RESLSD
	BCC DDIV62
	PLP
	ROL RESEXP
	DEY
	BPL DDIV50
;
;IS DIVISOR GREATER THAN DIVIDEND
;
DDIV70	LDY #FACMSD-FACLSD
	LDX #0
	SEC
	SED
DDIV72	LDA ARGLSD,X
	SBC FACLSD,X
	STA ARGLSD,X
	INX
	DEY
	BPL DDIV72
	LDA ARGEXP
	SBC FACEXP
	STA ARGEXP
	CLD
	BCC DDIV30
;
;INCREMENT RESLSD
;
DDIV80	INC RESLSD
	BNE DDIV70
.END
